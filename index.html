<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Monthly Transaction</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');

:root{
  --h:44px;
  --r:10px;
  --b:#d1d5db;
}

body{
  font-family:'Inter', sans-serif;
  background:linear-gradient(135deg,#eef2f7,#f9fafb);
  padding:20px;
}

form{
  background:#fff;
  max-width:440px;
  margin:auto;
  padding:22px;
  border-radius:16px;
  box-shadow:0 18px 40px rgba(0,0,0,.08);
}

h3{
  text-align:center;
  margin-bottom:16px;
  font-weight:600;
}

label{
  font-size:13px;
  font-weight:600;
  margin-top:14px;
  display:block;
  color:#374151;
}

input, select, button{
  width:100%;
  height:var(--h);
  margin-top:6px;
  padding:0 12px;
  border-radius:var(--r);
  border:1px solid var(--b);
  box-sizing:border-box;
  font-size:14px;
}

input:focus, select:focus{
  outline:none;
  border-color:#6366f1;
  box-shadow:0 0 0 3px rgba(99,102,241,.15);
}

button{
  background:#6366f1;
  color:#fff;
  border:none;
  margin-top:22px;
  font-weight:600;
  cursor:pointer;
}

button:hover{background:#4f46e5}

.hidden{display:none}
input:disabled{background:#f3f4f6}

/* ===== Cash cards ===== */
.cash-wrapper{
  border:1px solid #e5e7eb;
  border-radius:16px;
  padding:16px;
  margin-top:16px;
}

.cash-title{
  font-weight:600;
  color:#2563eb;
  margin-bottom:12px;
}

.cash-grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:14px;
}

.cash-card{
  border:1px solid #e5e7eb;
  border-radius:14px;
  padding:12px;
  text-align:center;
}

.cash-card span{
  display:block;
  font-weight:600;
  margin-bottom:8px;
}

.cash-card input{
  width:100%;
  height:40px;
  text-align:center;
}
/* ===== Mobile dropdown fix ===== */
select{
  background-color:#ffffff !important;
  color:#111827;
  appearance:none;
  -webkit-appearance:none;
  -moz-appearance:none;
}

/* iOS Safari fix */
select::-ms-expand{
  display:none;
}

/* Force white even when disabled */
select:disabled{
  background-color:#ffffff !important;
  color:#6b7280;
}

/* Android focus grey override */
select:focus{
  background-color:#ffffff !important;
}
select{
  background-image:
    linear-gradient(45deg, transparent 50%, #6b7280 50%),
    linear-gradient(135deg, #6b7280 50%, transparent 50%);
  background-position:
    calc(100% - 20px) 18px,
    calc(100% - 15px) 18px;
  background-size:5px 5px,5px 5px;
  background-repeat:no-repeat;
}
/* ===== Mobile dropdown fix ===== */
select{
  background-color:#ffffff !important;
  color:#111827;
  appearance:none;
  -webkit-appearance:none;
  -moz-appearance:none;
}

select::-ms-expand{display:none}

select:disabled{
  background-color:#ffffff !important;
  color:#6b7280;
}

select:focus{
  background-color:#ffffff !important;
}

/* ===== Mobile DATE input fix ===== */
input[type="date"]{
  background-color:#ffffff !important;
  color:#111827;
  appearance:none;
  -webkit-appearance:none;
  -moz-appearance:none;
}

input[type="date"]::-webkit-date-and-time-value{
  color:#111827;
}

input[type="date"]:focus{
  background-color:#ffffff !important;
}

input[type="date"]:disabled{
  background-color:#ffffff !important;
  color:#6b7280;
}

</style>
</head>

<body>

<form id="txnForm">
  <h3>Monthly Transaction</h3>

  <label>Date</label>
  <input type="date" id="date" required>

  <label>Narration</label>
  <input type="text" id="narration" required>

  <label>Purpose</label>
  <select id="purpose">
    <option value="">Select</option>
    <option>Business</option>
    <option>Donation</option>
    <option>Entertainment</option>
    <option>Food</option>
    <option>Grocery</option>
    <option>Hospital</option>
    <option>House</option>
    <option>Income</option>
    <option>Insurance</option>
    <option>Loan</option>
    <option>Medicines</option>
    <option>Miscellaneous</option>
    <option>Puja</option>
    <option>Tax</option>
    <option>Travelling</option>
    <option>Utility Bills</option>
    <option>Water</option>
    <option>Other</option>
  </select>
  <input id="purpose_other" class="hidden" placeholder="Enter purpose">

  <label>Spent for / Earned by</label>
  <select id="spent_for">
    <option value="">Select</option>
    <option>Self</option>
    <option>House</option>
    <option>Mother</option>
    <option>Father</option>
    <option>Family</option>
    <option>Vasavi</option>
    <option>Other</option>  </select>
  <input id="spent_for_other" class="hidden" placeholder="Enter name">

  <label>Transaction Flow</label>
  <select id="flow" required>
    <option value="">Select</option>
    <option value="withdraw">Withdraw</option>
    <option value="deposit">Deposit</option>
  </select>

  <label>Transaction Type</label>
  <select id="trtype" required>
    <option value="">Select</option>
    <option value="CASH">Cash</option>
    <option value="DEBIT">Debit</option>
    <option value="UPI">UPI</option>
    <option value="NET">Net</option>
    <option value="CREDIT">Credit</option>
  </select>

  <div id="accountBlock" class="hidden">
    <label>Account</label>
    <select id="account"></select>
  </div>

  <!-- CASH -->
  <div id="cashBlock" class="hidden cash-wrapper">
    <div class="cash-title">Cash Denominations</div>
    <div class="cash-grid" id="cashGrid"></div>
  </div>

  <div id="withdrawBlock" class="hidden">
    <label>Withdrawn Amount</label>
    <input type="number" id="withdrawn" step="0.01">
  </div>

  <div id="depositBlock" class="hidden">
    <label>Deposit Amount</label>
    <input type="number" id="deposit" step="0.01">
  </div>

  <button type="submit">Save Transaction</button>
</form>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyf3m0znn9DDB-GWwCICXwWqH7Si6g9FCX6tDgusMYnUQLhfI8EQGHZ-1eNaxTb8Gs/exec";

/* ===== DOM ===== */
const date = document.getElementById("date");
const narration = document.getElementById("narration");
const purpose = document.getElementById("purpose");
const purposeOther = document.getElementById("purpose_other");
const spentFor = document.getElementById("spent_for");
const spentForOther = document.getElementById("spent_for_other");
const flow = document.getElementById("flow");
const trtype = document.getElementById("trtype");
const accountBlock = document.getElementById("accountBlock");
const account = document.getElementById("account");
const withdrawBlock = document.getElementById("withdrawBlock");
const depositBlock = document.getElementById("depositBlock");
const withdrawn = document.getElementById("withdrawn");
const deposit = document.getElementById("deposit");
const cashBlock = document.getElementById("cashBlock");
const cashGrid = document.getElementById("cashGrid");

/* ===== Data ===== */
const bankAccounts = ["FI","HDFC Old","HDFC New","ICICI","IndusInd","Kotak","RBL","SBI"];
const creditCards = [ "Axis Flipkart","Axis MyZone","Axis Neo",
  "HDFC PhonePe","HDFC Tata Neu","HDFC Millennia",
  "HSBC","IDFC First Millenia",
  "ICICI Amazon","ICICI Coral","ICICI Expressions",
  "Indusind Plat Aura EDGE","Indusind Legend",
  "Yes Finbooster","Kotak League","Kotak Image",
  "SBI BPCL","Standard Chartered"];
const denoms = [500,200,100,50,20,10,5,2,1];

/* ===== Helpers ===== */
date.value = new Date().toISOString().split("T")[0];

purpose.addEventListener("change", () =>
  purposeOther.classList.toggle("hidden", purpose.value !== "Other")
);

spentFor.addEventListener("change", () =>
  spentForOther.classList.toggle("hidden", spentFor.value !== "Other")
);

trtype.addEventListener("change", () => {
  account.innerHTML = "";
  cashGrid.innerHTML = "";
  cashBlock.classList.add("hidden");

  withdrawn.value = "";
  deposit.value = "";
  withdrawn.disabled = false;
  deposit.disabled = false;

  if (trtype.value === "CASH") {
    accountBlock.classList.add("hidden");
    cashBlock.classList.remove("hidden");
    withdrawn.disabled = true;
    deposit.disabled = true;
    renderCash();
    return;
  }

  accountBlock.classList.remove("hidden");
  (trtype.value === "CREDIT" ? creditCards : bankAccounts)
    .forEach(a => account.add(new Option(a, a)));
});

flow.addEventListener("change", () => {
  withdrawBlock.classList.add("hidden");
  depositBlock.classList.add("hidden");

  if (flow.value === "withdraw") withdrawBlock.classList.remove("hidden");
  if (flow.value === "deposit") depositBlock.classList.remove("hidden");
});

/* ===== Cash Logic ===== */
function renderCash(){
  cashGrid.innerHTML = "";
  denoms.forEach(v => {
    const c = document.createElement("div");
    c.className = "cash-card";
    c.innerHTML = `
      <span>₹${v}</span>
      <input type="number" min="0" value="0" data-val="${v}">
    `;
    c.querySelector("input").addEventListener("input", calcCash);
    cashGrid.appendChild(c);
  });
}

function calcCash(){
  let total = 0;
  document.querySelectorAll("#cashGrid input").forEach(i => {
    total += Number(i.value || 0) * Number(i.dataset.val);
  });
  if (flow.value === "withdraw") withdrawn.value = total;
  if (flow.value === "deposit") deposit.value = total;
}

function getDenominationData(){
  const data = {};
  document.querySelectorAll("#cashGrid input").forEach(i => {
    data["d" + i.dataset.val] = i.value || 0;
  });
  return data;
}

/* ===== Submit ===== */
document.getElementById("txnForm").addEventListener("submit", e => {
  e.preventDefault();

  if (trtype.value === "CASH" && !flow.value) {
    alert("Please select Transaction Flow");
    return;
  }

  const params = new URLSearchParams();

  // Core fields
  params.append("category", "monthly transactions");
  params.append("date", date.value);
  params.append("narration", narration.value);
  params.append("purpose", purpose.value === "Other" ? purposeOther.value : purpose.value);
  params.append("spent_for", spentFor.value === "Other" ? spentForOther.value : spentFor.value);
  params.append("trtype", trtype.value);
  params.append("from_to", trtype.value === "CASH" ? "Cash" : account.value);
  params.append("withdrawn", withdrawn.value || 0);
  params.append("deposit", deposit.value || 0);

  // ✅ Append denominations SAFELY
  if (trtype.value === "CASH") {
    document.querySelectorAll("#cashGrid input").forEach(i => {
      params.append("d" + i.dataset.val, i.value || 0);
    });
  }

  fetch(SCRIPT_URL, {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: params
  })
  .then(() => {
    alert("Transaction saved successfully");
    e.target.reset();
    accountBlock.classList.add("hidden");
    cashBlock.classList.add("hidden");
    withdrawBlock.classList.add("hidden");
    depositBlock.classList.add("hidden");
    purposeOther.classList.add("hidden");
    spentForOther.classList.add("hidden");
    date.value = new Date().toISOString().split("T")[0];
  })
  .catch(() => alert("Error saving transaction"));
});
</script>

</body>
</html>

